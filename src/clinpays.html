<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">


  <title>Pruebas SDK</title>
</head>

<body>
<form id="frmPay" novalidate>
  <div id="root">
    <div class="mt-5 mb-5">
      <div class="container">
        <div class="justify-content-center row">
          <div class="col-xl-7 col-lg-8 col-md-10">
            <form>
              <div class="card mb-1">
                <div class="card-body">
                  <h5 class="card-title">Configuración</h5>

                  <div class="row align-items-start">

                    <div class="col-md-3">
                      <label class="form-label">ID de comercio</label>
                      <input required type="text" class="form-control" name="accountId"
                             placeholder="62c7d1d6e211..."
                             value="">
                    </div>

                    <div class="col-md-3">
                      <label class="form-label">Token</label>
                      <input required type="text" class="form-control" name="accountToken"
                             placeholder="eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9..."
                             value="">
                    </div>

                    <div class="col-md-3">
                      <label class="form-label">Ambiente</label>
                      <select required class="form-select" name="environment" aria-label="Ambiente">
                        <option value="LOCAL">Local</option>
                        <option value="DEV">Desarrollo</option>
                        <option value="STAGE">Pruebas</option>
                        <option value="PRODUCTION">Producción</option>
                      </select>
                    </div>

                    <div class="col-md-3">
                      <label class="form-label">Bitacora</label>
                      <select class="form-select" name="logs" aria-label="Ambiente">
                        <option value="true">Si</option>
                        <option value="false">No</option>
                      </select>
                    </div>


                  </div>
                </div>
              </div>

              <div class="dropdown-divider" role="separator"></div>

              <div class="card">
                <div class="card-body align-items-start">
                  <div class="row">
                    <h5 class="card-title text-uppercase">Datos personales</h5>

                    <div class="mb-1 row">
                      <div class="col-md-12">
                        <label for="firstName" class="form-label">Nombre de cliente</label>
                        <div class="row">
                          <div class="col-md-6">
                            <input class="form-control form-control-sm" type="text"
                                   data-billing="customerFirstName" name="customerFirstName"
                                   id="firstName" placeholder="nombre" value="">
                          </div>

                          <div class="col-md-6">
                            <input class="form-control form-control-sm" type="text"
                                   id="customerLastName" name="customerLastName"
                                   data-billing="customerLastName" placeholder="apellido"
                                   value="">
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="mb-1 row">
                      <div class="col-md-6">
                        <label for="mobilePhone" class="form-label">Número telefónico</label>
                        <input class="form-control form-control-sm" type="text" id="mobilePhone"
                               placeholder="+50499999999" data-billing="mobilePhone"
                               name="mobilePhone" value="">
                      </div>

                      <div class="col-md-6">
                        <label for="email" class="form-label">Correo</label>
                        <input class="form-control form-control-sm" type="email" id="email"
                               placeholder="john@doe.com" name="email" data-billing="email"
                               value="">
                      </div>
                    </div>
                  </div>

                  <div class="dropdown-divider" role="separator"></div>

                  <div class="row">
                    <h5 class="card-title text-uppercase">Datos de tarjeta</h5>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col-sm-12">Nombre de la
                        tarjeta</label>
                      <div class="col-sm-6">
                        <input required class="form-control form-control-sm" value="John"
                               name="firstName" data-billing="firstName" type="text">
                      </div>
                      <div class="col-sm-6">
                        <input placeholder="Nombre" class="form-control form-control-sm"
                               value="Doe" required name="lastName" data-billing="lastName"
                               type="text">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Número de tarjeta</label>
                      <div class="col-sm-12">

                        <select required class="form-select form-select-sm" aria-label="Default select example"
                                data-billing="safeIdentifier" name="safeIdentifier" id="selectCardinalCards">
                          <optgroup label="Test Case 1: Successful Authentication">
                            <option value="4000000000000002">4000000000000002</option>
                            <option value="5200000000000007">5200000000000007</option>
                            <option value="3520000000000922">3520000000000922</option>
                            <option value="340000000003961">340000000003961</option>
                            <option value="3005000000006246">3005000000006246</option>
                            <option value="6011000000000004">6011000000000004</option>
                          </optgroup>

                          <optgroup label="Test Case 2: Failed Signature">
                            <option value="4000000000000010">4000000000000010</option>
                            <option value="5200000000000015">5200000000000015</option>
                            <option value="3520000000002811">3520000000002811</option>
                            <option value="340000000006022">340000000006022</option>
                            <option value="3005000000004373">3005000000004373</option>
                            <option value="6011000000000012">6011000000000012</option>
                          </optgroup>

                          <optgroup label="Test Case 3: Failed Authentication">
                            <option value="4000000000000028">4000000000000028</option>
                            <option value="5200000000000023">5200000000000023</option>
                            <option value="3520000000009931">3520000000009931</option>
                            <option value="340000000000033">340000000000033</option>
                            <option value="3005000000005925">3005000000005925</option>
                            <option value="6011000000000020">6011000000000020</option>
                          </optgroup>

                          <optgroup label="Test Case 4: Attempts/Non-Participating">
                            <option value="4000000000000101">4000000000000101</option>
                            <option value="5200000000000908">5200000000000908</option>
                            <option value="3520000000004767">3520000000004767</option>
                            <option value="340000000003391">340000000003391</option>
                            <option value="3005000000005271">3005000000005271</option>
                            <option value="6011000000000038">6011000000000038</option>
                          </optgroup>

                          <optgroup label="Test Case 5: Timeout">
                            <option value="4000000000000044">4000000000000044</option>
                            <option value="5200000000000049">5200000000000049</option>
                            <option value="3520000000001284">3520000000001284</option>
                            <option value="340000000008309">340000000008309</option>
                            <option value="3005000000001890">3005000000001890</option>
                            <option value="6011000000000046">6011000000000046</option>
                          </optgroup>

                          <optgroup label="Test Case 6: Not Enrolled">
                            <option value="4000000000000051">4000000000000051</option>
                            <option value="5200000000000056">5200000000000056</option>
                            <option value="3520000000006903">3520000000006903</option>
                            <option value="340000000008135">340000000008135</option>
                            <option value="3005000000007269">3005000000007269</option>
                            <option value="6011000000000053">6011000000000053</option>
                          </optgroup>

                          <optgroup label="Test Case 7: Unavailable">
                            <option value="4000000000000069">4000000000000069</option>
                            <option value="5200000000000064">5200000000000064</option>
                            <option value="3520000000002423">3520000000002423</option>
                            <option value="340000000007780">340000000007780</option>
                            <option value="3005000000006030">3005000000006030</option>
                            <option value="6011000000000061">6011000000000061</option>
                          </optgroup>

                          <optgroup label="Test Case 8: Merchant Not Active">
                            <option value="4000000000000077">4000000000000077</option>
                            <option value="5200000000000072">5200000000000072</option>
                            <option value="3520000000006549">3520000000006549</option>
                            <option value="340000000008416">340000000008416</option>
                            <option value="3005000000004837">3005000000004837</option>
                            <option value="6011000000000079">6011000000000079</option>
                          </optgroup>

                          <optgroup label="Test Case 9: cmpi_lookup error">
                            <option value="4000000000000085">4000000000000085</option>
                            <option value="5200000000000080">5200000000000080</option>
                            <option value="3520000000002175">3520000000002175</option>
                            <option value="340000000006337">340000000006337</option>
                            <option value="3005000000009877">3005000000009877</option>
                            <option value="6011000000000087">6011000000000087</option>
                          </optgroup>

                          <optgroup label="Test Case 10: cmpi_authenticate error">
                            <option value="4000000000000093">4000000000000093</option>
                            <option value="5200000000000098">5200000000000098</option>
                            <option value="3520000000006861">3520000000006861</option>
                            <option value="340000000009299">340000000009299</option>
                            <option value="3005000000005602">3005000000005602</option>
                            <option value="6011000000000095">6011000000000095</option>
                          </optgroup>

                          <optgroup label="Test Case 11: Authentication Unavailable">
                            <option value="4000000000000036">4000000000000036</option>
                            <option value="5200000000000031">5200000000000031</option>
                            <option value="3520000000005780">3520000000005780</option>
                            <option value="340000000000116">340000000000116</option>
                            <option value="3005000000007376">3005000000007376</option>
                            <option value="6011000000000103">6011000000000103</option>
                          </optgroup>

                          <optgroup label="Test Case 12: Bypassed Authentication">
                            <option value="4000990000000004">4000990000000004</option>
                            <option value="5200990000000009">5200990000000009</option>
                            <option value="3500990000000001">3500990000000001</option>
                            <option value="340099000000001">340099000000001</option>
                            <option value="3000990000000006">3000990000000006</option>
                            <option value="6011990000000006">6011990000000006</option>
                          </optgroup>

                          <optgroup label="Test Case 13: Successful Frictionless Authentication">
                            <option value="4000000000001000">4000000000001000</option>
                            <option value="4000000000002701">4000000000002701</option>
                            <option value="5200000000001005">5200000000001005</option>
                            <option value="5200000000002235">5200000000002235</option>
                            <option value="340000000001007">340000000001007</option>
                            <option value="340000000002708">340000000002708</option>
                            <option value="6011000000001002">6011000000001002</option>
                            <option value="3337000000000008">3337000000000008</option>
                            <option value="3338000000000296">3338000000000296</option>
                            <option value="4000000000003006">4000000000003006</option>
                            <option value="5200000000003001">5200000000003001</option>
                            <option value="6505050000001000">6505050000001000</option>
                            <option value="6200010000200000">6200010000200000</option>
                          </optgroup>

                          <optgroup label="Test Case 14: Failed Frictionless Authentication">
                            <option value="4000000000001018">4000000000001018</option>
                            <option value="4000000000002925">4000000000002925</option>
                            <option value="5200000000001013">5200000000001013</option>
                            <option value="5200000000002276">5200000000002276</option>
                            <option value="340000000001015">340000000001015</option>
                            <option value="340000000002096">340000000002096</option>
                            <option value="6011000000001010">6011000000001010</option>
                            <option value="3337000000000990">3337000000000990</option>
                            <option value="3338000000000361">3338000000000361</option>
                            <option value="4000000000003014">4000000000003014</option>
                            <option value="5200000000003019">5200000000003019</option>
                            <option value="6505050000001018">6505050000001018</option>
                            <option value="6200010000100010">6200010000100010</option>
                          </optgroup>

                          <optgroup label="Test Case 15: Attempts Stand-In Frictionless Authentication">
                            <option value="4000000000001026">4000000000001026</option>
                            <option value="4000000000002719">4000000000002719</option>
                            <option value="5200000000001021">5200000000001021</option>
                            <option value="5200000000002482">5200000000002482</option>
                            <option value="340000000001023">340000000001023</option>
                            <option value="340000000002872">340000000002872</option>
                            <option value="6011000000001028">6011000000001028</option>
                            <option value="3337000000007045">3337000000007045</option>
                            <option value="3338000000000585">3338000000000585</option>
                            <option value="4000000000003022">4000000000003022</option>
                            <option value="5200000000003027">5200000000003027</option>
                            <option value="6505050000001026">6505050000001026</option>
                            <option value="6200010000000020">6200010000000020</option>
                          </optgroup>

                          <optgroup label="Test Case 16: Unavailable Frictionless Authentication from the Issuer">
                            <option value="4000000000001034">4000000000001034</option>
                            <option value="4000000000002313">4000000000002313</option>
                            <option value="5200000000001039">5200000000001039</option>
                            <option value="5200000000002268">5200000000002268</option>
                            <option value="340000000001031">340000000001031</option>
                            <option value="340000000002922">340000000002922</option>
                            <option value="6011000000001036">6011000000001036</option>
                            <option value="3337000000000735">3337000000000735</option>
                            <option value="3338000000000221">3338000000000221</option>
                            <option value="4000000000003030">4000000000003030</option>
                            <option value="5200000000003035">5200000000003035</option>
                            <option value="6505050000001034">6505050000001034</option>
                            <option value="6200010000400030">6200010000400030</option>
                          </optgroup>

                          <optgroup label="Test Case 17: Rejected Frictionless Authentication by the Issuer">
                            <option value="4000000000001042">4000000000001042</option>
                            <option value="4000000000002537">4000000000002537</option>
                            <option value="5200000000001047">5200000000001047</option>
                            <option value="5200000000002185">5200000000002185</option>
                            <option value="340000000001049">340000000001049</option>
                            <option value="340000000002062">340000000002062</option>
                            <option value="6011000000001044">6011000000001044</option>
                            <option value="3337000000000321">3337000000000321</option>
                            <option value="3338000000000734">3338000000000734</option>
                            <option value="4000000000003048">4000000000003048</option>
                            <option value="5200000000003043">5200000000003043</option>
                            <option value="6505050000001042">6505050000001042</option>
                            <option value="6200010000300040">6200010000300040</option>
                          </optgroup>

                          <optgroup label="Test Case 18: Authentication Not Available on Lookup">
                            <option value="4000000000001059">4000000000001059</option>
                            <option value="4000000000002990">4000000000002990</option>
                            <option value="5200000000001054">5200000000001054</option>
                            <option value="5200000000002409">5200000000002409</option>
                            <option value="340000000001056">340000000001056</option>
                            <option value="340000000002468">340000000002468</option>
                            <option value="6011000000001051">6011000000001051</option>
                            <option value="3337000000006765">3337000000006765</option>
                            <option value="3338000000000940">3338000000000940</option>
                            <option value="4000000000003055">4000000000003055</option>
                            <option value="5200000000003050">5200000000003050</option>
                            <option value="6505050000001059">6505050000001059</option>
                            <option value="6200010000600050">6200010000600050</option>
                          </optgroup>

                          <optgroup label="Test Case 19: Error on Lookup">
                            <option value="4000000000001067">4000000000001067</option>
                            <option value="4000000000002446">4000000000002446</option>
                            <option value="5200000000001062">5200000000001062</option>
                            <option value="5200000000002037">5200000000002037</option>
                            <option value="340000000001064">340000000001064</option>
                            <option value="340000000002732">340000000002732</option>
                            <option value="6011000000001069">6011000000001069</option>
                            <option value="3337000000000016">3337000000000016</option>
                            <option value="3338000000000650">3338000000000650</option>
                            <option value="4000000000003063">4000000000003063</option>
                            <option value="5200000000003068">5200000000003068</option>
                            <option value="6505050000001067">6505050000001067</option>
                            <option value="6200010000500060">6200010000500060</option>
                          </optgroup>

                          <optgroup label="Test Case 20: Timeout on cmpi_lookup Transaction">
                            <option value="4000000000001075">4000000000001075</option>
                            <option value="4000000000002354">4000000000002354</option>
                            <option value="5200000000001070">5200000000001070</option>
                            <option value="5200000000002326">5200000000002326</option>
                            <option value="340000000001072">340000000001072</option>
                            <option value="340000000002047">340000000002047</option>
                            <option value="6011000000001077">6011000000001077</option>
                            <option value="3337000000000081">3337000000000081</option>
                            <option value="3338000000000577">3338000000000577</option>
                            <option value="4000000000003071">4000000000003071</option>
                            <option value="5200000000003076">5200000000003076</option>
                            <option value="6505050000001075">6505050000001075</option>
                            <option value="6200010000900070">6200010000900070</option>
                          </optgroup>

                          <optgroup label="Test Case 21: Successful Step Up Authentication">
                            <option value="4000000000001091">4000000000001091</option>
                            <option value="4000000000002503">4000000000002503</option>
                            <option value="5200000000001096">5200000000001096</option>
                            <option value="5200000000002151">5200000000002151</option>
                            <option value="340000000001098">340000000001098</option>
                            <option value="340000000002534">340000000002534</option>
                            <option value="6011000000001093">6011000000001093</option>
                            <option value="3337000000200004">3337000000200004</option>
                            <option value="3338000000000569">3338000000000569</option>
                            <option value="4000000000003139">4000000000003139</option>
                            <option value="5200000000003092">5200000000003092</option>
                            <option value="6505050000001091">6505050000001091</option>
                            <option value="6200019999800019">6200019999800019</option>
                          </optgroup>

                          <optgroup label="Test Case 22: Failed Step Up Authentication">
                            <option value="4000000000001109">4000000000001109</option>
                            <option value="4000000000002370">4000000000002370</option>
                            <option value="5200000000001104">5200000000001104</option>
                            <option value="5200000000002490">5200000000002490</option>
                            <option value="340000000001106">340000000001106</option>
                            <option value="340000000002237">340000000002237</option>
                            <option value="6011000000001101">6011000000001101</option>
                            <option value="3337000000200087">3337000000200087</option>
                            <option value="3338000000000874">3338000000000874</option>
                            <option value="4000000000003097">4000000000003097</option>
                            <option value="5200000000003100">5200000000003100</option>
                            <option value="6505050000001109">6505050000001109</option>
                            <option value="6200019999700029">6200019999700029</option>
                          </optgroup>

                          <optgroup label="Test Case 23: Step Up Authentication is Unavailable">
                            <option value="4000000000001117">4000000000001117</option>
                            <option value="4000000000002420">4000000000002420</option>
                            <option value="5200000000001112">5200000000001112</option>
                            <option value="5200000000002664">5200000000002664</option>
                            <option value="340000000001114">340000000001114</option>
                            <option value="340000000002484">340000000002484</option>
                            <option value="6011000000001119">6011000000001119</option>
                          </optgroup>

                        </select>
                      </div>
                    </div>

                    <div class="mb-1 row">
                      <div class="col-sm-6">
                        <div class="mb-1 form-group row">
                          <label class="pb-0 form-label col-form-label col">Fecha de
                            expiración</label>
                          <div class="row">
                            <div class="col-sm-4">
                              <input required value="10" maxlength="2" name="cardExpMonth"
                                     placeholder="MM" class="form-control form-control-sm"
                                     data-billing="cardExpMonth">
                            </div>
                            <div class="col-sm-4">
                              <input required value="25" maxlength="2" name="cardExpYear"
                                     placeholder="AA" class="form-control form-control-sm"
                                     data-billing="cardExpYear">
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-sm-6">
                        <div class="mb-1 form-group row">
                          <label class="pb-0 form-label col-form-label col">CVV</label>
                          <div class="col-sm-12">
                            <input required maxlength="4" name="cvv" value="258" placeholder="1234"
                                   class="form-control form-control-sm" data-billing="cvv">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="dropdown-divider" role="separator"></div>

                  <div class="row">
                    <h5 class="card-title text-uppercase">Detalle de pago</h5>
                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Monto</label>
                      <div class="col-sm-7">
                        <input name="amount" type="number" value=""
                               class="form-control form-control-sm" required
                               data-billing="amount">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Descripción pago</label>
                      <div class="col-sm-7">
                        <input name="description" type="text" value=""
                               class="form-control form-control-sm" required
                               data-billing="description">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Moneda</label>
                      <div class="col-sm-7">
                        <input name="currency" type="text" value=""
                               class="form-control form-control-sm"
                               data-billing="currency">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Referencia</label>
                      <div class="col-sm-7">
                        <input name="referenceId" type="text" value=""
                               class="form-control form-control-sm"
                               data-billing="referenceId">
                      </div>
                    </div>
                  </div>

                  <div class="dropdown-divider" role="separator"></div>

                  <div class="row">
                    <h5 class="card-title text-uppercase">Facturación</h5>


                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">País</label>
                      <div class="col-sm-7" id="containerBillingCountryCode">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Departamento</label>
                      <div class="col-sm-7" id="containerBillingState">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Ciudad</label>
                      <div class="col-sm-7">
                        <input name="billingCity" type="text" value="SPS"
                               class="form-control form-control-sm"
                               data-billing="billingCity">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0 form-label col-form-label col">Código postal</label>
                      <div class="col-sm-7">
                        <input name="billingPostCode" type="text" value=""
                               class="form-control form-control-sm"
                               data-billing="billingPostCode">
                      </div>
                    </div>

                    <div class="mb-1 form-group row">
                      <label class="pb-0  form-label col-form-label col">Dirección de
                        facturación</label>
                      <div class="col-sm-7">
                                                <textarea name="billingAddress1" class="form-control form-control-sm"
                                                          value="Res. Andalucia"
                                                          data-billing="billingAddress1"></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="card-footer d-grid gap-2" id="paySection">
                  <button type="submit" name="btnPay" class="btn btn-secondary">Pagar</button>
                </div>
                <div class="row">
                  <div class="col-md-12 text-center">
                    <div hidden="true" id="loading" class="spinner-border "></div>
                  </div>
                </div>

              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>


</body>
<script src="../dist/paygate.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"
        integrity="sha512-UNM1njAgOFUa74Z0bADwAq8gbTcqZC8Ej4xPSzpnh0l6KMevwvkBvbldF9uR++qKeJ+MOZHRjV1HZjoRvjDfNQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://unpkg.com/imask"></script>

<script type='text/javascript'>

  IMask(
    document.querySelector('[name="mobilePhone"]'), {
      mask: '+{5\\04} 0000-0000'
    });

  IMask(
    document.querySelector('[name="cvv"]'), {
      mask: /^[0-9]+$/
    });

  let countries = [];

  let withCardinal = false;
  const divAlertMessageIdName = 'alertMessage';
  const acceptedPayload = [
    'cvv',
    'email',
    'amount',
    'lastName',
    'validThru',
    'firstName',
    'description',
    'mobilePhone',
    'billingCity',
    'customerName',
    'billingState',
    'safeIdentifier',
    'billingAddress1',
    'billingCountryCode',
    'billingPostCode',
    'orderNumber',
    'currency',
    'epoc',
    'b2cc'
  ];

  const loading = document.getElementById("loading");
  const btnPay = document.querySelector('[name="btnPay"]');
  document.querySelector('[name="referenceId"]').value = uuid.v4();

  const createSelect = (attributes) => {
    const select = document.createElement('select');

    Object.keys(attributes).forEach(key => {
      select.setAttribute(key, attributes[key]);
    });

    select.classList.add(`form-select`);
    select.classList.add(`form-select-sm`);

    return select;
  }

  const setBillingStateSelectOptions = (selectRef, states = []) => {
    states.forEach(state => {
      const { alpha2, name } = state;
      const option = document.createElement('option');
      option.value = alpha2.toString();
      option.textContent = name;

      selectRef.appendChild(option);
    })
  }

  const getStates = (countryNumericCode) => {
    const [states] = countries.filter(({ numericCode }) => Number(numericCode) === Number(countryNumericCode))
      .map(countries => countries.states);
    return states;
  }

  const init = async () => {

    countries  = await  Paygate.getCountriesAndStates();

    const containerBillingState = document.getElementById('containerBillingState');
    const containerBillingCountryCode = document.getElementById('containerBillingCountryCode');

    const selectBillingCountryCodeAttributes = {
      id: "billingCountryCode",
      name: "billingCountryCode",
      "data-billing": "billingCountryCode"
    };
    const selectBillingCountryCode = createSelect(selectBillingCountryCodeAttributes);

    countries.forEach(function (country) {
      const { numericCode, name } = country;
      const option = document.createElement('option');
      option.value = numericCode.toString();
      option.textContent = name;

      selectBillingCountryCode.appendChild(option);
    });

    containerBillingCountryCode.appendChild(selectBillingCountryCode);

    const selectBillingStateAttributes = {
      id: "billingState",
      name: "billingState",
      "data-billing": "billingState"
    };
    const selectBillingState = createSelect(selectBillingStateAttributes);

    const country = document.getElementById('billingCountryCode');

    const states = getStates(country.value);

    setBillingStateSelectOptions(selectBillingState, states);
    containerBillingState.appendChild(selectBillingState);

    country.addEventListener('change', function (e) {
      selectBillingState.options.length = 0;
      const states = getStates(this.value);
      setBillingStateSelectOptions(selectBillingState, states);

    })

  }

  const resetValues = () => {
    acceptedPayload.forEach(name => {
      const input = document.querySelector(`[name=${name}]`);
      if (input) {
        input.value = '';
      }
    });
  }

  const setLoading = (isLoading) => {
    btnPay.disabled = isLoading;
    loading.hidden = !isLoading;
  };

  const removeAlertMessage = () => {
    const exists = document.getElementById(divAlertMessageIdName);

    if (exists) {
      exists.parentElement.removeChild(exists);
    }
  }

  const showMessage = (message, classAlert = 'success') => {

    removeAlertMessage();

    let div = document.createElement("div");
    div.setAttribute("id", divAlertMessageIdName);

    div.classList.add(`alert`);
    div.classList.add(`alert-${classAlert}`);
    div.classList.add('text-center');
    div.textContent = message;

    const paySection = document.getElementById('paySection');
    paySection.appendChild(div);
  }

  const sanatizePayload = (data) => {
    let _data = {};
    if (!data || typeof data !== 'object') {
      throw new Error('Se esperaba un objeto');
    }

    acceptedPayload.forEach(keyName => {
      if (data[keyName] !== undefined) {
        _data[keyName] = data[keyName];
      }
    });
    const { amount } = _data;
    return { ..._data, amount: Number(amount) };
  }

  init();

  document.getElementById('frmPay').addEventListener('submit', async function (e) {
    try {

      if (this.checkValidity() === false) {
        e.preventDefault();
        e.stopPropagation();
        this.reportValidity();
        this.classList.add('was-validated')
        return;
      } else {
        e.preventDefault();
        this.classList.add('was-validated');

      }

      removeAlertMessage();
      setLoading(true);

      const accountId = document.querySelector('[name="accountId"]').value;
      const debug = document.querySelector('[name="logs"]').value === 'true';
      const environment = document.querySelector('[name="environment"]').value;
      const accountToken = document.querySelector('[name="accountToken"]').value;

      let payload = {}
      let billingField = document.querySelectorAll('[data-billing]');

      billingField.forEach(function (field) {
        const value = field.value
        const key = field.dataset.billing

        payload[key] = value;

      });

      const country = document.getElementById('billingCountryCode');

      payload = {
        ...payload,
        _id: accountId,
        token: accountToken,
        orderNumber: uuid.v4(),
        safeIdentifier: payload['safeIdentifier'].replace(/\D/g, ''),
        validThru: `${payload['cardExpMonth']}/${payload['cardExpYear']}`,
        mobilePhone: payload['mobilePhone'].replace(' ', '').replace('-', ''),
        customerName: `${payload['customerFirstName']} ${payload['customerLastName']}`,
        b2cc: countries.find(c => c.numericCode === Number(country.value)).alpha2 || 'HN',
        epoc: Math.round(new Date().getTime() / 1000)
      }

      await Paygate.configure_link(payload, environment)

      Paygate.debug(debug);

      const { amount, transactionID } = await Paygate.payOrder(sanatizePayload(payload));
      const message = `Pago realizado correctamente, LPS ${amount} TransactionID: ${transactionID}`;
      showMessage(message);
      setLoading(false);
      // resetValues();
    } catch ({ message }) {
      setLoading(false);
      showMessage(message, 'danger');
      throw new Error(message);
    }
  });
</script>

</html>
